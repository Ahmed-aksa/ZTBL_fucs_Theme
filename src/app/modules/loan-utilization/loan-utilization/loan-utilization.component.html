<div class=" px-10  sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent" [formGroup]="customerForm">
    <div class="text-3xl font-extrabold tracking-tight mt-6 pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Loan Utilization</div>
    <div class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between
     py-2" style="flex-wrap: wrap" >


        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
            <mat-form-field class="mat-form-field-fluid" appearance="outline" *ngIf="single_zone">
                <mat-label class="customMatLabel">Zone</mat-label>
                <mat-select [(ngModel)]="selected_z" formControlName="Zone" [disabled]="disable_zone">
                    <mat-option [value]="SelectedZones?.ZoneId">
                        {{SelectedZones?.ZoneName}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="mat-form-field-fluid" appearance="outline" *ngIf="!single_zone">
                <mat-label class="customMatLabel">Zone</mat-label>
                <mat-select [(ngModel)]="selected_z" formControlName="Zone" [disabled]="disable_zone"
                            (selectionChange)="changeZone($event)">
                    <mat-option *ngFor="let zone of SelectedZones" [value]="zone?.ZoneId"
                                [disabled]="disable_zone">
                        {{zone?.ZoneName}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
            <mat-form-field class="mat-form-field-fluid" appearance="outline">
                <mat-label class="customMatLabel">Branch <strong class="matMandatory">*</strong></mat-label>
                <mat-select [(ngModel)]="selected_b" formControlName="Branch" [disabled]="disable_branch"
                            (selectionChange)="changeBranch($event)"
                            *ngIf="!single_branch">
                    <mat-option *ngFor="let branch of SelectedBranches" [value]="branch?.BranchCode"
                    >
                        {{branch?.Name}}
                    </mat-option>
                </mat-select>
                <mat-select [(ngModel)]="selected_b" formControlName="Branch" [disabled]="disable_branch"
                            *ngIf="single_branch">
                    <mat-option [value]="SelectedBranches?.BranchCode"
                    >
                        {{SelectedBranches?.Name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
            <mat-form-field class="mat-form-field-fluid" appearance="outline">
                <mat-label class="customMatLabel">LC NO#</mat-label>
                <input readonly appNumberOnly matInput placeholder="Enter LC No#" formControlName="LoanCaseNo"
                       maxlength="13" autocomplete="off"/>
            </mat-form-field>
        </div>

        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
            <mat-form-field class="mat-form-field-fluid" appearance="outline">
                <mat-label>Loan GL</mat-label>
<!--                [ngClass]="{ 'is-invalid': f.LoanDisbID.touched && f.LoanDisbID.errors }"-->
                <mat-select [disabled]='viewonly' formControlName="LoanDisbID" >
                    <mat-option>
                        Select
                    </mat-option>
                    <mat-option *ngFor="let obj of LoanGls" [value]="obj.LoanDisbID">
                        {{obj.DisbDesc}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-error *ngIf="isControlHasError('LoanDisbID','required')">
                <strong class="mx-3">Loan Disbursment ID is mandatory</strong>
            </mat-error>

        </div>

        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
            <input matInput hidden formControlName="Status" maxlength="13" autocomplete="off"/>
        </div>


    </div>

    <!-- Header -->
    <div class="flex flex-auto px-0 overflow-x-hidden" style="flex-direction: column; overflow-y: scroll">
        <div class="col-lg-12 tab-box">

            <div class="text-3xl font-extrabold tracking-tight pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Loan Application</div>
            <mat-tab-group mat-align-tabs="start">

                <!-- Applicants -->
                <mat-tab label="Applicants" class="px-0">
                    <div *ngIf="LoanApplicants" class="table-responsive px-0">
                        <table class="table table-striped">
                            <thead>
                            <tr class="table-header-background">
                                <th>Customer Id</th>
                                <th>Customer Name</th>
                                <th>Cnic</th>
                                <th>Father Name</th>
                                <th>AGPS</th>
                                <th>DOB</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let item of LoanApplicants;">

                                <td>{{item.CustomerId}}</td>
                                <td>{{item.CustomerName}}</td>
                                <td>{{item.Cnic}}</td>
                                <td>{{item.FatherName}}</td>
                                <td>{{item.Agps}}</td>
                                <td>{{item.DOB | date: 'dd-MM-yyyy'}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 *ngIf="!LoanApplicants">Data not found.</h3>
                </mat-tab>
                <!-- Purpose -->
                <mat-tab label="Purpose">
                    <div *ngIf="Loanpurpose" class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr class="table-header-background">
                                <th>GL Description</th>
                                <th>Crop</th>
                                <th>Capacity</th>
                                <th>TotalEstimatedCost</th>
                                <th>Equity</th>
                                <th>Amount Required</th>
                                <th>Prod/Dev Flag</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let item of Loanpurpose;">
                                <td>{{item.GlDescription}}</td>
                                <td>{{item.CropName}}</td>
                                <td>{{item.Capacity}}</td>
                                <td>{{item.TotalEstimatedCost}}</td>
                                <td>{{item.Equity}}</td>
                                <td>{{item.AmountRequired}}</td>
                                <td>{{item.ProdDev}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 *ngIf="!Loanpurpose">Data not found.</h3>
                </mat-tab>
                <!-- here -->

            </mat-tab-group>
        </div>
        <div *ngIf="DisbursementsRecoveries">
            <div class="kt-portlet__head kt-portlet__head__custom" >
                <div class="kt-portlet__head-label">
                    <div class="text-3xl font-extrabold tracking-tight pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Disbursements/Recoveries</div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr class="table-header-background">
                            <th>Gl Description</th>
                            <th>Scheme Code</th>
                            <th>Crop Code</th>
                            <th>Disb Date</th>
                            <th>Disbursed Amount</th>
                            <th>Balance</th>
                            <th>Disb Status Name</th>
                            <th>New Next Due Date</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let val of DisbursementsRecoveries">
                            <td>{{val.GlDescription}}</td>
                            <td>{{val.SchemeCode}}</td>
                            <td>{{val.CropCode}}</td>
                            <td>{{val.DisbDate}}</td>
                            <td>{{val.DisbursedAmount}}</td>
                            <td>{{val.Balance}}</td>
                            <td>{{val.DisbStatusName}}</td>
                            <td>{{val.NewNextDueDate}}</td>
                            <!-- <td style="cursor: pointer; color: #ecbd00;"> <span (click)="viewDocument(img.ID, $event)">View</span></td> -->
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- images -->
        <div class="kt-portlet__head kt-portlet__head__custom"style="width: 100%">
            <div class="kt-portlet__head-label">
                <div class="text-3xl font-extrabold tracking-tight pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Attach Images</div>
                <mat-error *ngIf="hasError('file', 'required')">Must Contain a Image<strong>required</strong>
                </mat-error>
            </div>
        </div>

        <div>

            <input *ngIf="!viewonly" (click)="ifResetRequired()" type='file' formControlName="file"
                   accept="image/jpg, image/jpeg" (change)="onSelectFile($event)"/>
            <div class="mt-4" *ngIf="imageUrl.length>0 && visible"
                 style="display: flex !important;flex-direction: row !important;flex-wrap: wrap !important;gap: 10px">
                <div *ngFor='let url of imageUrl; let i = index'>
                    <!-- <button *ngIf="!viewonly" (click)="removeImage(url,i)">
                        X"
                    </button> -->
                    <div class="row">
                        <div class="col-lg-12  text-right relative">
                            <div class="bg-white float-right">
                                <button mat-icon-button *ngIf="!viewonly" (click)="removeImage(url,i)" class="close-button float-right absolute right-4 top-2 bg-red-500">
                                    <!-- X -->
                                    <mat-icon class="close-icon w-12 h-12 text-white">close</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="width: 320px;height: 240px;">
                        <img [src]="url" (click)="previewImg(url)" width="240px" height="240px">
                    </div>
                </div>
            </div>

        </div>
        <!--        Video-->
            <div class="kt-portlet__head kt-portlet__head__custom" >
                <div class="kt-portlet__head-label">
                    <div class="text-3xl font-extrabold tracking-tight pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Attach Videos</div>
                    <mat-error *ngIf="hasError('fileV', 'required')">Must Contain a Video<strong>required</strong>
                    </mat-error>
                </div>
            </div>

            <div>
                <input  [required] *ngIf="!viewonly" (click)="ifResetRequiredV()" formControlName="fileV" type='file'
                       accept="video/*" (change)="onSelectFileV($event)"/>
            </div>

            <ng-container>
                <div *ngIf="videoUrl.length>0 && visible"
                     style="display: flex !important;flex-direction: row !important;flex-wrap: wrap !important;gap: 10px">
                    <div class="item m-2" *ngFor="let url of videoUrl;let i = index">
                        <!-- <button *ngIf="!viewonly" (click)="removeVideo(url,i)">
                            X
                        </button> -->
                        <div class="row">
                            <div class="col-lg-12 text-right relative">
                                <div class="bg-white float-right">
                                    <button mat-icon-button *ngIf="!viewonly" (click)="removeVideo(url,i)" class="close-button float-right absolute right-4 top-2 bg-red-500">
                                        <!-- X -->
                                        <mat-icon class="close-icon text-white w-12 h-12 text-white">close</mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- <button type="button" class="btn-close" aria-label="Close" (click)="removeVideo(i)"></button> -->
                        <div>
                            <!-- <video (loadedmetadata)="getDuration($event,i)"  height="240px" width="320px" [src]="url" controls></video> -->
                            <video style="height: 240px;" #video width="320" height="240" controls [attr.src]="url"
                                   (loadedmetadata)="getDuration($event,i)">
                            </video>
                        </div>
                    </div>
                </div>
            </ng-container>
        <div class="row">
<!--            <mat-form-field class="mat-form-field-fluid" appearance="outline">-->
<!--                <mat-label class="customMatLabel">Remarks</mat-label>-->
<!--                <input  matInput placeholder="Enter Remarks" formControlName="remarks"-->
<!--                       maxlength="100" autocomplete="off"/>-->
<!--&lt;!&ndash;                <mat-error *ngIf="hasError('remarks', 'required')">Date of Death <strong>required</strong></mat-error>&ndash;&gt;-->
<!--            </mat-form-field>-->

            <div class="col-md-12 col-sm-12">
            <mat-form-field class="mat-form-field-fluid w-full h-24" appearance="outline">
                <mat-label class="customMatLabel">Remarks<strong class="matMandatory">*</strong></mat-label>
                <input matInput placeholder="Enter Remarks" formControlName="Remarks" maxlength="20" autocomplete="off"
                       [readonly]='remarksFeild'/>
            </mat-form-field>
            </div>
        </div>
    </div>
<div class="row">
    <div class="col-lg-12 text-right">
        <div class="float-right mr-4 mt-4 border-t py-6">
            <button class="ml-2" *ngIf="isSave" mat-raised-button color="primary" (click)="save()">Save</button>
            <button class="ml-2" *ngIf="isSubmit" mat-raised-button color="primary" (click)="changeStatus('S')">Submit
            </button>
            <button class="ml-2" *ngIf="isReffer" mat-raised-button color="primary" (click)="changeStatus('R')">Reffer
                Back
            </button>
            <button class="ml-2" *ngIf="isAuthorize" mat-raised-button color="primary" (click)="changeStatus('A')">
                Authorize
            </button>
            <button *ngIf="isDelete" class="ml-2" mat-raised-button color="primary" (click)="changeStatus('C')">Delete
            </button>
        </div>
    </div>
</div>


</div>
