<div
    class=" px-10  sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 overflow-y-scroll bg-card dark:bg-transparent"
    [formGroup]="customerForm">
    <div class="heading">Loan Utilization
    </div>


    <!-- Header -->
    <div class="flex flex-auto px-0" style="flex-direction: column; ">
        <div>


            <div class="flex" style="flex-wrap: wrap;">
                <app-zone-branch-circle [form]="customerForm" [should_show_circle]="false"
                                        (branchZoneCircleData)="getAllData($event)"></app-zone-branch-circle>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <mat-form-field class="mat-form-field-fluid w-full" appearance="outline">
                            <mat-label class="customMatLabel">LC NO#</mat-label>
                            <input readonly appNumberOnly matInput placeholder="Enter LC No#"
                                   formControlName="LoanCaseNo"
                                   maxlength="13" autocomplete="off"/>
                        </mat-form-field>
                    </div>
                </div>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0">
                            <mat-form-field class="mat-form-field-fluid w-full" appearance="outline">
                                <mat-label>Loan GL</mat-label>
                                <!--                [ngClass]="{ 'is-invalid': f.LoanDisbID.touched && f.LoanDisbID.errors }"-->
                                <mat-select [disabled]="'true'" formControlName="LoanDisbID">
                                    <mat-option>
                                        Select
                                    </mat-option>
                                    <mat-option *ngFor="let obj of LoanGls" [value]="obj.LoanDisbID">
                                        {{obj.DisbDesc}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-error *ngIf="isControlHasError('LoanDisbID','required')">
                                <strong class="mx-3">Loan Disbursment ID is mandatory</strong>
                            </mat-error>
                        </div>
                    </div>

                </div>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <mat-form-field class="mat-form-field-fluid w-full" appearance="outline">
                            <mat-label class="customMatLabel">Gl Sub Code</mat-label>
                            <input readonly appNumberOnly matInput placeholder="Gl Sub Code" formControlName="GlSubCode"
                                   maxlength="13" autocomplete="off"/>
                        </mat-form-field>
                    </div>
                </div>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <mat-form-field class="mat-form-field-fluid w-full" appearance="outline">
                            <mat-label class="customMatLabel">Crop Code</mat-label>
                            <input readonly appNumberOnly matInput placeholder="CropCode" formControlName="CropCode"
                                   maxlength="13" autocomplete="off"/>
                        </mat-form-field>
                    </div>
                </div>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <mat-form-field class="mat-form-field-fluid w-full" appearance="outline">
                            <mat-label class="customMatLabel">Scheme Code</mat-label>
                            <input readonly appNumberOnly matInput placeholder="SchemeCode" formControlName="SchemeCode"
                                   maxlength="13" autocomplete="off"/>
                        </mat-form-field>
                    </div>
                </div>
                <div class="mx-2">
                    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0" style="width: 225px;">
                        <input matInput hidden formControlName="Status" maxlength="13" autocomplete="off"/>
                    </div>
                </div>

            </div>


        </div>
        <div class="col-lg-12 py-2 tab-box">

            <div class="heading">Loan Application
            </div>
            <mat-tab-group mat-align-tabs="start">

                <!-- Applicants -->
                <mat-tab label="Applicants" class="px-0">
                    <div *ngIf="LoanApplicants" class="table-responsive px-0">
                        <table class="table table-striped">
                            <thead>
                            <tr class="table-header-background">
                                <th style="min-width: 150px;">Cnic</th>
                                <th>Customer Name</th>
                                <th>Father Name</th>
                                <th>AGPS</th>
                                <th>DOB</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let item of LoanApplicants;">
                                <td style="min-width: 150px;">{{item.Cnic}}</td>
                                <td>{{item.CustomerName}}</td>
                                <td>{{item.FatherName}}</td>
                                <td>{{item.Agps}}</td>
                                <td>{{item.DOB | date: 'dd-MM-yyyy'}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 *ngIf="!LoanApplicants">Data not found.</h3>
                </mat-tab>
                <!-- Purpose -->
                <mat-tab label="Purpose">
                    <div *ngIf="Loanpurpose" class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr class="table-header-background">
                                <th>GL Description</th>
                                <th>Crop</th>
                                <th>Capacity</th>
                                <th>TotalEstimatedCost</th>
                                <th>Equity</th>
                                <th>Amount Required</th>
                                <th>Prod/Dev Flag</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let item of Loanpurpose;">
                                <td>{{item.GlDescription}}</td>
                                <td>{{item.CropName}}</td>
                                <td>{{item.Capacity}}</td>
                                <td>{{item.TotalEstimatedCost}}</td>
                                <td>{{item.Equity}}</td>
                                <td>{{item.AmountRequired}}</td>
                                <td>{{item.ProdDev}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 *ngIf="!Loanpurpose">Data not found.</h3>
                </mat-tab>
                <!-- here -->

            </mat-tab-group>
        </div>
        <!--        <div *ngIf="DisbursementsRecoveries">-->
        <!--            <div class="kt-portlet__head kt-portlet__head__custom" >-->
        <!--                <div class="kt-portlet__head-label">-->
        <!--                    <div class="text-3xl font-extrabold tracking-tight pb-2 border-b mb-2 border-green-500 p-2" style="background-color: #f6fcf8;">Disbursements/Recoveries</div>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--            <div class="col-lg-12">-->
        <!--                <div class="table-responsive">-->
        <!--                    <table class="table table-striped">-->
        <!--                        <thead>-->
        <!--                        <tr class="table-header-background">-->
        <!--                            <th>Gl Description</th>-->
        <!--                            <th>Scheme Code</th>-->
        <!--                            <th>Crop Code</th>-->
        <!--                            <th>Disb Date</th>-->
        <!--                            <th>Disbursed Amount</th>-->
        <!--                            <th>Balance</th>-->
        <!--                            <th>Disb Status Name</th>-->
        <!--                            <th>New Next Due Date</th>-->
        <!--                        </tr>-->
        <!--                        </thead>-->
        <!--                        <tbody>-->
        <!--                        <tr *ngFor="let val of DisbursementsRecoveries">-->
        <!--                            <td>{{val.GlDescription}}</td>-->
        <!--                            <td>{{val.SchemeCode}}</td>-->
        <!--                            <td>{{val.CropCode}}</td>-->
        <!--                            <td>{{val.DisbDate}}</td>-->
        <!--                            <td>{{val.DisbursedAmount}}</td>-->
        <!--                            <td>{{val.Balance}}</td>-->
        <!--                            <td>{{val.DisbStatusName}}</td>-->
        <!--                            <td>{{val.NewNextDueDate}}</td>-->
        <!--                            &lt;!&ndash; <td style="cursor: pointer; color: #ecbd00;"> <span (click)="viewDocument(img.ID, $event)">View</span></td> &ndash;&gt;-->
        <!--                        </tr>-->
        <!--                        </tbody>-->
        <!--                    </table>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--        </div>-->

        <!-- images -->
        <div class="kt-portlet__head kt-portlet__head__custom" style="width: 100%">
            <div class="kt-portlet__head-label">
                <div class="heading">Attach Images
                </div>
                <mat-error *ngIf="hasError('file', 'required')">Must Contain a Image<strong>required</strong>
                </mat-error>
            </div>
        </div>

        <div class="row py-2">
            <div class="col-lg-12 col-sm-12">
                <input *ngIf="!viewonly" (click)="ifResetRequired()" type='file' formControlName="file"
                       accept="image/jpg, image/jpeg" (change)="onSelectFile($event)"/>
                <div class="mt-4 overflow-scroll" *ngIf="imageUrl.length>0 && visible"
                     style="display: flex !important;flex-direction: row !important;flex-wrap: wrap !important;gap: 10px">
                    <div *ngFor='let url of imageUrl; let i = index'>
                        <!-- <button *ngIf="!viewonly" (click)="removeImage(url,i)">
                            X"
                        </button> -->
                        <div class="row">
                            <div class="col-lg-12  text-right relative">
                                <div class="bg-white float-right">
                                    <button mat-icon-button *ngIf="!viewonly" (click)="removeImage(url,i)"
                                            class="close-button float-right absolute right-4 top-2 bg-red-500">
                                        <!-- X -->
                                        <mat-icon class="close-icon w-12 h-12 text-white">close</mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div style="width: 240px;">
                            <img [src]="url" (click)="previewImg(url)">
                            <button class="my-2 mat-focus-indicator mat-flat-button mat-button-base mat-primary" mat-flat-button  (click)="viewMap(i,false)"><mat-icon class="mr-2">remove_red_eye</mat-icon>View Location</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!--        Video-->
        <div class="kt-portlet__head kt-portlet__head__custom">
            <div class="kt-portlet__head-label">
                <div class="heading mb-2">Attach Videos
                </div>
                <mat-error *ngIf="hasError('fileV', 'required')">Must Contain a Video<strong>required</strong>
                </mat-error>
            </div>
        </div>

        <div>
            <input [required] *ngIf="!viewonly" (click)="ifResetRequiredV()" formControlName="fileV" type='file'
                   accept="video/*" (change)="onSelectFileV($event)"/>
        </div>

        <ng-container class="py-2">
            <div *ngIf="videoUrl.length>0 && visible"
                 style="display: flex !important;flex-direction: row !important;flex-wrap: wrap !important;gap: 10px">
                <div class="item m-2" *ngFor="let url of videoUrl;let i = index">
                    <!-- <button *ngIf="!viewonly" (click)="removeVideo(url,i)">
                        X
                    </button> -->
                    <div class="row">
                        <div class="col-lg-12 text-right relative">
                            <div class="bg-white float-right">
                                <button mat-icon-button *ngIf="!viewonly" (click)="removeVideo(url,i)"
                                        class="close-button float-right absolute right-4 top-2 bg-red-500">
                                    <!-- X -->
                                    <mat-icon class="close-icon text-white w-12 h-12 text-white">close</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- <button type="button" class="btn-close" aria-label="Close" (click)="removeVideo(i)"></button> -->
                    <div>
                        <!-- <video (loadedmetadata)="getDuration($event,i)"  height="240px" width="320px" [src]="url" controls></video> -->
                        <video style="height: 240px;" #video width="320" height="240" controls [attr.src]="url"
                               (loadedmetadata)="getDuration($event,i)">
                        </video>
                        <button class="my-2 mat-focus-indicator mat-flat-button mat-button-base mat-primary" mat-flat-button  (click)="viewMap(i,true)"><mat-icon class="mr-2">remove_red_eye</mat-icon>View Location</button>

                    </div>
                </div>
            </div>
        </ng-container>
        <div class="row">
            <!--            <mat-form-field class="mat-form-field-fluid" appearance="outline">-->
            <!--                <mat-label class="customMatLabel">Remarks</mat-label>-->
            <!--                <input  matInput placeholder="Enter Remarks" formControlName="remarks"-->
            <!--                       maxlength="100" autocomplete="off"/>-->
            <!--&lt;!&ndash;                <mat-error *ngIf="hasError('remarks', 'required')">Date of Death <strong>required</strong></mat-error>&ndash;&gt;-->
            <!--            </mat-form-field>-->

            <div class="col-md-12 col-sm-12">
                <mat-form-field class="mat-form-field-fluid w-full h-24" appearance="outline">
                    <mat-label class="customMatLabel">Remarks<strong class="matMandatory">*</strong></mat-label>
                    <input matInput placeholder="Enter Remarks" formControlName="Remarks" maxlength="20"
                           autocomplete="off"
                           [readonly]='remarksFeild'/>
                </mat-form-field>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 text-right">
                <div class="float-right mr-4 mt-4 border-t py-6">
                    <button class="ml-2 bg-green mat-focus-indicator mat-flat-button mat-button-base mat-primary" *ngIf="isSave" mat-raised-button  (click)="save()"><mat-icon class="mr-2">save</mat-icon>Save</button>
                    <button class="ml-2 mat-focus-indicator mat-flat-button mat-button-base mat-primary" *ngIf="isSubmit" mat-raised-button color="primary" (click)="changeStatus('S')">
                        <mat-icon class="mr-2">check_circle</mat-icon>Submit
                    </button>
                    <button class="ml-2" *ngIf="isReffer" mat-raised-button color="primary" (click)="changeStatus('R')">
                        Reffer
                        Back
                    </button>
                    <button class="ml-2" *ngIf="isAuthorize" mat-raised-button color="primary"
                            (click)="changeStatus('A')">
                        Authorize
                    </button>
                    <button *ngIf="isDelete" class="ml-2" mat-raised-button color="primary" (click)="changeStatus('C')">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>


</div>
