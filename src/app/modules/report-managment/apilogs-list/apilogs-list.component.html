<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent">
    <div class="text-4xl font-extrabold tracking-tight">API Logs</div>
    <!-- Header -->
    <div class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-8 px-6 md:px-8 border-b"
         style="flex-wrap: wrap" [formGroup]="FilterForm">
        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <mat-form-field appearance="outline">
                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search" autocomplete="off"
                       appearance="outline">
                <mat-hint align="start"><strong>Search</strong> in all fields</mat-hint>
            </mat-form-field>
        </div>
        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <mat-form-field class="mat-form-field-fluid" appearance="outline">
                <mat-label>Choose start date</mat-label>
                <input matInput [matDatepicker]="picker1" formControlName="StartDate"
                       (dateChange)="comparisonStartdateValidator()" autocomplete="off">

                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>

                <mat-datepicker #picker1></mat-datepicker>

                <mat-error *ngIf="FilterForm.controls['StartDate'].hasError('invaliddaterange')">
                    <strong>Start date cannot be greater than end date</strong>
                </mat-error>
                <mat-error *ngIf="hasError('StartDate', 'required')">Start Date <strong>required</strong>
                </mat-error>

            </mat-form-field>
        </div>
        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <mat-form-field class="mat-form-field-fluid" appearance="outline">
                <mat-label>Choose end date</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="EndDate"
                       (dateChange)="comparisonEnddateValidator()" autocomplete="off">

                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>

                <mat-error *ngIf="FilterForm.controls['EndDate'].hasError('invaliddaterange')">
                    <strong>End date cannot be earlier than start date</strong>
                </mat-error>

                <mat-error *ngIf="hasError('EndDate', 'required')">End Date <strong>required</strong></mat-error>
            </mat-form-field>
        </div>
        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <button mat-raised-button color="accent"
                    type="button" (click)="loadApiLogs()">
                <mat-icon>search</mat-icon>
                Find
            </button>
        </div>
    </div>

    <section matSort class="mat-elevation-z2 mat-header-row">
        <span class="mat-header-cell" mat-sort-header="Id" style="width: 10px;">ID</span>
        <span class="mat-header-cell" mat-sort-header="TransactionId">Transaction ID</span>
        <span class="mat-header-cell" mat-sort-header="ApiName">API Name</span>
        <span class="mat-header-cell" mat-sort-header="CallDateTime">Call Date Time</span>
        <span class="mat-header-cell" mat-sort-header="ResponseDateTime">Response Date Time</span>
        <span class="mat-header-cell" mat-sort-header="ResponseDateTime">Total Time Taken</span>
        <span class="mat-header-cell" mat-sort-header="View">View</span>
    </section>
    <mat-accordion displayMode="flat" multi class="mat-table" style="overflow-y:scroll;">


        <mat-expansion-panel *ngFor="let item of displayedRows$ |async"
                             (click)="fetch3rdAPI($event,item)">
            <mat-expansion-panel-header class="mat-row">
                <span class="mat-cell" style="width: 10px;">{{item?.Id}}</span>
                <span class="mat-cell">{{item?.TransactionId}}</span>
                <span class="mat-cell">{{item?.APIName}}</span>
                <span class="mat-cell">{{item?.CallDateTime}}</span>
                <span class="mat-cell">{{item?.ResponseDateTime}}</span>
                <span class="mat-cell">{{item?.TotalTimeTaken}}</span>
                <span class="mat-cell">
                    <button mat-icon-button color="primary" (click)="viewRequestResponse($event,item)">
                                            <mat-icon title="View">visibility</mat-icon>
                                        </button>
                </span>
            </mat-expansion-panel-header>
            <div *ngFor="let tp_item of third_party_apis">
                <div class="custom-accordion-body">
                    <table class="table table-responsive" style="display: inline-table !important;">
                        <thead class="thead-light">
                        <tr>
                            <th>ID</th>
                            <th>Transaction ID</th>
                            <th>API Name</th>
                            <th>Call Date Time</th>
                            <th>Response Date Time</th>
                            <th>Total Time Taken</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>{{tp_item?.Id}}</td>
                            <td>{{tp_item?.TransactionId}}</td>
                            <td>{{tp_item?.APIName}}</td>
                            <td>{{tp_item?.CallDateTime}}</td>
                            <td>{{tp_item?.ResponseDateTime}}</td>
                            <td>{{tp_item?.TotalTimeTaken}}</td>
                            <td>
                                <button mat-icon-button color="primary"
                                        (click)="viewRequestResponse($event,tp_item,true)">
                                    <mat-icon title="View">visibility</mat-icon>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </mat-expansion-panel>

    </mat-accordion>

    <mat-paginator #paginator
                   [length]="totalRows$ | async"
                   [pageIndex]="0"
                   [pageSize]="10"
                   [pageSizeOptions]="[5, 10, 25, 100]"
    ></mat-paginator>
</div>

